<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ryan Leadbetter">
<meta name="dcterms.date" content="2025-02-10">

<title>Main analysis of chapter six</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="sup-material-ch6_files/libs/clipboard/clipboard.min.js"></script>
<script src="sup-material-ch6_files/libs/quarto-html/quarto.js"></script>
<script src="sup-material-ch6_files/libs/quarto-html/popper.min.js"></script>
<script src="sup-material-ch6_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="sup-material-ch6_files/libs/quarto-html/anchor.min.js"></script>
<link href="sup-material-ch6_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="sup-material-ch6_files/libs/quarto-html/quarto-syntax-highlighting-07ba0ad10f5680c660e360ac31d2f3b6.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="sup-material-ch6_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="sup-material-ch6_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="sup-material-ch6_files/libs/bootstrap/bootstrap-15dc1d1377a37cf150f55a9bb1055385.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: #000000;
      }

      .quarto-title-block .quarto-title-banner {
        color: #000000;
background: #FFFFFF;
      }
</style>
<link href="sup-material-ch6_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="sup-material-ch6_files/libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Main analysis of chapter six</h1>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Ryan Leadbetter </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Centre for Transforming Maintenance through Data Science, Curtin University
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 10, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#belt-wear-data" id="toc-belt-wear-data" class="nav-link active" data-scroll-target="#belt-wear-data"><span class="header-section-number">1</span> Belt wear data</a></li>
  <li><a href="#a-typical-way-of-forecasting-belt-wear" id="toc-a-typical-way-of-forecasting-belt-wear" class="nav-link" data-scroll-target="#a-typical-way-of-forecasting-belt-wear"><span class="header-section-number">2</span> A typical way of forecasting belt wear</a></li>
  <li><a href="#our-models" id="toc-our-models" class="nav-link" data-scroll-target="#our-models"><span class="header-section-number">3</span> Our models</a>
  <ul class="collapse">
  <li><a href="#b-spline-design-matrix" id="toc-b-spline-design-matrix" class="nav-link" data-scroll-target="#b-spline-design-matrix"><span class="header-section-number">3.1</span> B-spline design matrix</a></li>
  <li><a href="#sec-informative-priors" id="toc-sec-informative-priors" class="nav-link" data-scroll-target="#sec-informative-priors"><span class="header-section-number">3.2</span> Informative prior</a></li>
  <li><a href="#prior-predictive-checks" id="toc-prior-predictive-checks" class="nav-link" data-scroll-target="#prior-predictive-checks"><span class="header-section-number">3.3</span> Prior predictive checks</a></li>
  </ul></li>
  <li><a href="#stan-models" id="toc-stan-models" class="nav-link" data-scroll-target="#stan-models"><span class="header-section-number">4</span> Stan models</a>
  <ul class="collapse">
  <li><a href="#lm" id="toc-lm" class="nav-link" data-scroll-target="#lm"><span class="header-section-number">4.1</span> LM</a></li>
  <li><a href="#gp" id="toc-gp" class="nav-link" data-scroll-target="#gp"><span class="header-section-number">4.2</span> GP</a></li>
  </ul></li>
  <li><a href="#sampling" id="toc-sampling" class="nav-link" data-scroll-target="#sampling"><span class="header-section-number">5</span> Sampling</a></li>
  <li><a href="#posterior" id="toc-posterior" class="nav-link" data-scroll-target="#posterior"><span class="header-section-number">6</span> Posterior</a>
  <ul class="collapse">
  <li><a href="#marginal" id="toc-marginal" class="nav-link" data-scroll-target="#marginal"><span class="header-section-number">6.1</span> Marginal</a></li>
  <li><a href="#intermediate-values" id="toc-intermediate-values" class="nav-link" data-scroll-target="#intermediate-values"><span class="header-section-number">6.2</span> Intermediate values</a></li>
  <li><a href="#posterior-predictive-distributions" id="toc-posterior-predictive-distributions" class="nav-link" data-scroll-target="#posterior-predictive-distributions"><span class="header-section-number">6.3</span> Posterior predictive distributions</a></li>
  </ul></li>
  <li><a href="#forecast" id="toc-forecast" class="nav-link" data-scroll-target="#forecast"><span class="header-section-number">7</span> Forecast</a></li>
  <li><a href="#failure-time-cdf" id="toc-failure-time-cdf" class="nav-link" data-scroll-target="#failure-time-cdf"><span class="header-section-number">8</span> Failure time CDF</a></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>This Quarto document contains an adapted version of the sumplementary material for the manuscript <em>Functional degradation modelling of the wearing surface of conveyor belting using Bayesian hierarchical modelling and Gamma processes.</em> to produce the code in Chap. 6: <em>Conveyor belt wear forecasting</em>. This document acts as suplimentary material to the main text for readers who are interested in reproducing the analysis or just want to take a closer look at the the more technical aspects of the data, model fitting, diagnostics, and model evaluation.</p>
<div class="cell">
<details class="code-fold">
<summary>Show setup chunk</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdist)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines2)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wesanderson)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(distributional)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Stan options</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot theme options</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_update</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>))</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>figure_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">".."</span>, <span class="st">".."</span>, <span class="st">"figures"</span>, <span class="st">"ch-6"</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>table_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">".."</span>, <span class="st">".."</span>, <span class="st">"tables"</span>, <span class="st">"ch-6"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="belt-wear-data" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="belt-wear-data"><span class="header-section-number">1</span> Belt wear data</h2>
<p>The data we use are ultrasonic thickness (UT) measurements used to monitor the wear of the top coat on an overland conveyor belt. We use data from three belts all installed on the same overland conveyor at different points in time at one of our industry partners mine sites. <a href="#fig-scematic" class="quarto-xref">Figure&nbsp;1</a> below shows a typical overland conveyorbelt on the left and a scematic of the belts on the right. The structural component on of the belt is the carcas, which is protected by a tob and bottom coat of rubber. Typicaly the top-coat wears much faster than the bottom-coat because it is constantly being loaded with ore. To monitor the thickness of the topcoat, and therefore ensure the protection of the carcas, the thickness of the topcoat is monitored through UT testing. To demonstrate what the raw data looks like, on the cross section of the belt shown in the figure below, we have overlayed three sets of UT thickness measurements on the topcoat. Light blue is the earliest measurement and dark blue is the most recent. From the three wear profiles we can see the fairly typical “dishing out” of the topcoat as it is worn away by the ore over time.</p>
<div id="fig-scematic" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-scematic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="belt-cm-example.PNG" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-scematic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Example of conveyor belt condition monitoring
</figcaption>
</figure>
</div>
<p>The main belt that we will analise is <code>Belt_A</code>, the most recent belt. However, we use the data from historic belts <code>Belt_B</code> and <code>Belt_C</code> to construct an informative prior for some of the parameters in our model. Below we plot the raw data and show the UT data in a table below. Note that these data data are recorded in <em>mm</em> of wear, rather than remaining thickness like in the cross section of the belt shown in <a href="#fig-scematic" class="quarto-xref">Figure&nbsp;1</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">file.path</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">".."</span>, <span class="st">".."</span>, <span class="st">"data"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Example_beltwear_data.RData"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>zero_wear <span class="ot">&lt;-</span> example_belts[[<span class="st">"belt_A"</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tonnes <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">mean</span>(wear))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>example_belts[[<span class="st">"belt_A"</span>]] <span class="ot">&lt;-</span> example_belts[[<span class="st">"belt_A"</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wear =</span> wear <span class="sc">-</span> zero_wear[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>belt_wear_data <span class="ot">&lt;-</span> example_belts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Belt_A</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Belt_B</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Belt_C</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-fig-hight="5">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sup-material-ch6_files/figure-html/belt-a-raw-prof-fig-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption>Wear profile of belt A.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div data-pagedtable="false"> <div class="table-caption"><p>Wear data for belt A.</p></div>
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["operation_time"],"name":[1],"type":["drtn"],"align":["right"]},{"label":["measurement_pos"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["wear"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["tonnes"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"0 days","2":"0.375","3":"0.14","4":"0.0000000"},{"1":"0 days","2":"1.125","3":"0.04","4":"0.0000000"},{"1":"0 days","2":"1.875","3":"-0.16","4":"0.0000000"},{"1":"0 days","2":"2.625","3":"-0.16","4":"0.0000000"},{"1":"0 days","2":"3.375","3":"-0.06","4":"0.0000000"},{"1":"0 days","2":"4.125","3":"-0.06","4":"0.0000000"},{"1":"0 days","2":"4.875","3":"0.04","4":"0.0000000"},{"1":"0 days","2":"5.625","3":"0.14","4":"0.0000000"},{"1":"0 days","2":"6.375","3":"-0.16","4":"0.0000000"},{"1":"0 days","2":"7.125","3":"0.14","4":"0.0000000"},{"1":"0 days","2":"7.875","3":"-0.06","4":"0.0000000"},{"1":"0 days","2":"8.625","3":"-0.06","4":"0.0000000"},{"1":"0 days","2":"9.375","3":"-0.06","4":"0.0000000"},{"1":"0 days","2":"10.125","3":"0.04","4":"0.0000000"},{"1":"0 days","2":"10.875","3":"-0.16","4":"0.0000000"},{"1":"0 days","2":"11.625","3":"0.24","4":"0.0000000"},{"1":"0 days","2":"12.375","3":"-0.06","4":"0.0000000"},{"1":"0 days","2":"13.125","3":"0.04","4":"0.0000000"},{"1":"0 days","2":"13.875","3":"0.04","4":"0.0000000"},{"1":"0 days","2":"14.625","3":"0.14","4":"0.0000000"},{"1":"22 days","2":"0.375","3":"0.14","4":"0.1280347"},{"1":"22 days","2":"1.125","3":"0.44","4":"0.1280347"},{"1":"22 days","2":"1.875","3":"0.84","4":"0.1280347"},{"1":"22 days","2":"2.625","3":"0.64","4":"0.1280347"},{"1":"22 days","2":"3.375","3":"0.84","4":"0.1280347"},{"1":"22 days","2":"4.125","3":"0.64","4":"0.1280347"},{"1":"22 days","2":"4.875","3":"0.94","4":"0.1280347"},{"1":"22 days","2":"5.625","3":"1.14","4":"0.1280347"},{"1":"22 days","2":"6.375","3":"1.84","4":"0.1280347"},{"1":"22 days","2":"7.125","3":"2.04","4":"0.1280347"},{"1":"22 days","2":"7.875","3":"2.04","4":"0.1280347"},{"1":"22 days","2":"8.625","3":"1.74","4":"0.1280347"},{"1":"22 days","2":"9.375","3":"1.94","4":"0.1280347"},{"1":"22 days","2":"10.125","3":"1.44","4":"0.1280347"},{"1":"22 days","2":"10.875","3":"1.84","4":"0.1280347"},{"1":"22 days","2":"11.625","3":"1.34","4":"0.1280347"},{"1":"22 days","2":"12.375","3":"1.34","4":"0.1280347"},{"1":"22 days","2":"13.125","3":"0.94","4":"0.1280347"},{"1":"22 days","2":"13.875","3":"0.94","4":"0.1280347"},{"1":"22 days","2":"14.625","3":"0.04","4":"0.1280347"},{"1":"34 days","2":"0.375","3":"-0.16","4":"0.2193020"},{"1":"34 days","2":"1.125","3":"0.84","4":"0.2193020"},{"1":"34 days","2":"1.875","3":"1.24","4":"0.2193020"},{"1":"34 days","2":"2.625","3":"1.64","4":"0.2193020"},{"1":"34 days","2":"3.375","3":"1.84","4":"0.2193020"},{"1":"34 days","2":"4.125","3":"2.04","4":"0.2193020"},{"1":"34 days","2":"4.875","3":"2.44","4":"0.2193020"},{"1":"34 days","2":"5.625","3":"2.54","4":"0.2193020"},{"1":"34 days","2":"6.375","3":"3.34","4":"0.2193020"},{"1":"34 days","2":"7.125","3":"3.34","4":"0.2193020"},{"1":"34 days","2":"7.875","3":"3.64","4":"0.2193020"},{"1":"34 days","2":"8.625","3":"3.94","4":"0.2193020"},{"1":"34 days","2":"9.375","3":"3.94","4":"0.2193020"},{"1":"34 days","2":"10.125","3":"3.64","4":"0.2193020"},{"1":"34 days","2":"10.875","3":"3.04","4":"0.2193020"},{"1":"34 days","2":"11.625","3":"2.94","4":"0.2193020"},{"1":"34 days","2":"12.375","3":"2.64","4":"0.2193020"},{"1":"34 days","2":"13.125","3":"1.84","4":"0.2193020"},{"1":"34 days","2":"13.875","3":"1.24","4":"0.2193020"},{"1":"34 days","2":"14.625","3":"0.24","4":"0.2193020"},{"1":"39 days","2":"0.375","3":"0.54","4":"0.2562716"},{"1":"39 days","2":"1.125","3":"1.34","4":"0.2562716"},{"1":"39 days","2":"1.875","3":"1.64","4":"0.2562716"},{"1":"39 days","2":"2.625","3":"2.34","4":"0.2562716"},{"1":"39 days","2":"3.375","3":"2.64","4":"0.2562716"},{"1":"39 days","2":"4.125","3":"3.34","4":"0.2562716"},{"1":"39 days","2":"4.875","3":"4.24","4":"0.2562716"},{"1":"39 days","2":"5.625","3":"4.34","4":"0.2562716"},{"1":"39 days","2":"6.375","3":"5.64","4":"0.2562716"},{"1":"39 days","2":"7.125","3":"5.34","4":"0.2562716"},{"1":"39 days","2":"7.875","3":"5.44","4":"0.2562716"},{"1":"39 days","2":"8.625","3":"5.24","4":"0.2562716"},{"1":"39 days","2":"9.375","3":"5.04","4":"0.2562716"},{"1":"39 days","2":"10.125","3":"5.04","4":"0.2562716"},{"1":"39 days","2":"10.875","3":"4.44","4":"0.2562716"},{"1":"39 days","2":"11.625","3":"3.74","4":"0.2562716"},{"1":"39 days","2":"12.375","3":"2.84","4":"0.2562716"},{"1":"39 days","2":"13.125","3":"1.84","4":"0.2562716"},{"1":"39 days","2":"13.875","3":"1.54","4":"0.2562716"},{"1":"39 days","2":"14.625","3":"0.24","4":"0.2562716"},{"1":"48 days","2":"0.375","3":"0.34","4":"0.3146593"},{"1":"48 days","2":"1.125","3":"1.74","4":"0.3146593"},{"1":"48 days","2":"1.875","3":"1.84","4":"0.3146593"},{"1":"48 days","2":"2.625","3":"2.54","4":"0.3146593"},{"1":"48 days","2":"3.375","3":"2.74","4":"0.3146593"},{"1":"48 days","2":"4.125","3":"2.94","4":"0.3146593"},{"1":"48 days","2":"4.875","3":"3.04","4":"0.3146593"},{"1":"48 days","2":"5.625","3":"4.24","4":"0.3146593"},{"1":"48 days","2":"6.375","3":"4.84","4":"0.3146593"},{"1":"48 days","2":"7.125","3":"5.54","4":"0.3146593"},{"1":"48 days","2":"7.875","3":"5.54","4":"0.3146593"},{"1":"48 days","2":"8.625","3":"5.44","4":"0.3146593"},{"1":"48 days","2":"9.375","3":"5.44","4":"0.3146593"},{"1":"48 days","2":"10.125","3":"4.84","4":"0.3146593"},{"1":"48 days","2":"10.875","3":"4.74","4":"0.3146593"},{"1":"48 days","2":"11.625","3":"3.74","4":"0.3146593"},{"1":"48 days","2":"12.375","3":"3.14","4":"0.3146593"},{"1":"48 days","2":"13.125","3":"2.14","4":"0.3146593"},{"1":"48 days","2":"13.875","3":"2.14","4":"0.3146593"},{"1":"48 days","2":"14.625","3":"1.44","4":"0.3146593"},{"1":"73 days","2":"0.375","3":"0.04","4":"0.5019453"},{"1":"73 days","2":"1.125","3":"2.04","4":"0.5019453"},{"1":"73 days","2":"1.875","3":"1.94","4":"0.5019453"},{"1":"73 days","2":"2.625","3":"2.44","4":"0.5019453"},{"1":"73 days","2":"3.375","3":"2.84","4":"0.5019453"},{"1":"73 days","2":"4.125","3":"3.44","4":"0.5019453"},{"1":"73 days","2":"4.875","3":"3.84","4":"0.5019453"},{"1":"73 days","2":"5.625","3":"5.14","4":"0.5019453"},{"1":"73 days","2":"6.375","3":"6.24","4":"0.5019453"},{"1":"73 days","2":"7.125","3":"7.34","4":"0.5019453"},{"1":"73 days","2":"7.875","3":"7.44","4":"0.5019453"},{"1":"73 days","2":"8.625","3":"6.64","4":"0.5019453"},{"1":"73 days","2":"9.375","3":"6.14","4":"0.5019453"},{"1":"73 days","2":"10.125","3":"5.64","4":"0.5019453"},{"1":"73 days","2":"10.875","3":"5.44","4":"0.5019453"},{"1":"73 days","2":"11.625","3":"3.84","4":"0.5019453"},{"1":"73 days","2":"12.375","3":"2.44","4":"0.5019453"},{"1":"73 days","2":"13.125","3":"2.04","4":"0.5019453"},{"1":"73 days","2":"13.875","3":"1.14","4":"0.5019453"},{"1":"73 days","2":"14.625","3":"1.04","4":"0.5019453"},{"1":"89 days","2":"0.375","3":"1.74","4":"0.6348471"},{"1":"89 days","2":"1.125","3":"3.44","4":"0.6348471"},{"1":"89 days","2":"1.875","3":"3.54","4":"0.6348471"},{"1":"89 days","2":"2.625","3":"4.34","4":"0.6348471"},{"1":"89 days","2":"3.375","3":"4.94","4":"0.6348471"},{"1":"89 days","2":"4.125","3":"5.34","4":"0.6348471"},{"1":"89 days","2":"4.875","3":"6.14","4":"0.6348471"},{"1":"89 days","2":"5.625","3":"5.64","4":"0.6348471"},{"1":"89 days","2":"6.375","3":"9.24","4":"0.6348471"},{"1":"89 days","2":"7.125","3":"10.64","4":"0.6348471"},{"1":"89 days","2":"7.875","3":"10.54","4":"0.6348471"},{"1":"89 days","2":"8.625","3":"10.34","4":"0.6348471"},{"1":"89 days","2":"9.375","3":"8.14","4":"0.6348471"},{"1":"89 days","2":"10.125","3":"7.04","4":"0.6348471"},{"1":"89 days","2":"10.875","3":"5.84","4":"0.6348471"},{"1":"89 days","2":"11.625","3":"6.54","4":"0.6348471"},{"1":"89 days","2":"12.375","3":"5.24","4":"0.6348471"},{"1":"89 days","2":"13.125","3":"3.24","4":"0.6348471"},{"1":"89 days","2":"13.875","3":"2.84","4":"0.6348471"},{"1":"89 days","2":"14.625","3":"1.74","4":"0.6348471"},{"1":"129 days","2":"0.375","3":"0.74","4":"0.8193773"},{"1":"129 days","2":"1.125","3":"3.34","4":"0.8193773"},{"1":"129 days","2":"1.875","3":"3.74","4":"0.8193773"},{"1":"129 days","2":"2.625","3":"3.94","4":"0.8193773"},{"1":"129 days","2":"3.375","3":"4.54","4":"0.8193773"},{"1":"129 days","2":"4.125","3":"5.04","4":"0.8193773"},{"1":"129 days","2":"4.875","3":"6.14","4":"0.8193773"},{"1":"129 days","2":"5.625","3":"7.14","4":"0.8193773"},{"1":"129 days","2":"6.375","3":"7.74","4":"0.8193773"},{"1":"129 days","2":"7.125","3":"9.24","4":"0.8193773"},{"1":"129 days","2":"7.875","3":"9.94","4":"0.8193773"},{"1":"129 days","2":"8.625","3":"9.44","4":"0.8193773"},{"1":"129 days","2":"9.375","3":"8.34","4":"0.8193773"},{"1":"129 days","2":"10.125","3":"9.54","4":"0.8193773"},{"1":"129 days","2":"10.875","3":"6.64","4":"0.8193773"},{"1":"129 days","2":"11.625","3":"6.24","4":"0.8193773"},{"1":"129 days","2":"12.375","3":"3.94","4":"0.8193773"},{"1":"129 days","2":"13.125","3":"3.04","4":"0.8193773"},{"1":"129 days","2":"13.875","3":"3.04","4":"0.8193773"},{"1":"129 days","2":"14.625","3":"0.94","4":"0.8193773"},{"1":"155 days","2":"0.375","3":"2.64","4":"1.0000000"},{"1":"155 days","2":"1.125","3":"4.84","4":"1.0000000"},{"1":"155 days","2":"1.875","3":"5.34","4":"1.0000000"},{"1":"155 days","2":"2.625","3":"6.74","4":"1.0000000"},{"1":"155 days","2":"3.375","3":"7.14","4":"1.0000000"},{"1":"155 days","2":"4.125","3":"7.64","4":"1.0000000"},{"1":"155 days","2":"4.875","3":"8.34","4":"1.0000000"},{"1":"155 days","2":"5.625","3":"10.24","4":"1.0000000"},{"1":"155 days","2":"6.375","3":"12.94","4":"1.0000000"},{"1":"155 days","2":"7.125","3":"15.34","4":"1.0000000"},{"1":"155 days","2":"7.875","3":"15.74","4":"1.0000000"},{"1":"155 days","2":"8.625","3":"15.14","4":"1.0000000"},{"1":"155 days","2":"9.375","3":"13.94","4":"1.0000000"},{"1":"155 days","2":"10.125","3":"13.04","4":"1.0000000"},{"1":"155 days","2":"10.875","3":"11.54","4":"1.0000000"},{"1":"155 days","2":"11.625","3":"8.94","4":"1.0000000"},{"1":"155 days","2":"12.375","3":"5.94","4":"1.0000000"},{"1":"155 days","2":"13.125","3":"3.04","4":"1.0000000"},{"1":"155 days","2":"13.875","3":"3.94","4":"1.0000000"},{"1":"155 days","2":"14.625","3":"0.94","4":"1.0000000"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-fig-hight="5">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sup-material-ch6_files/figure-html/belt-b-raw-prof-fig-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption>Wear profile of belt b.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div data-pagedtable="false"> <div class="table-caption"><p>Wear data for belt B.</p></div>
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["operation_time"],"name":[1],"type":["drtn"],"align":["right"]},{"label":["measurement_pos"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["wear"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["tonnes"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"0 days","2":"0.375","3":"0.0","4":"0.0000000"},{"1":"0 days","2":"1.125","3":"0.3","4":"0.0000000"},{"1":"0 days","2":"1.875","3":"0.3","4":"0.0000000"},{"1":"0 days","2":"2.625","3":"0.2","4":"0.0000000"},{"1":"0 days","2":"3.375","3":"0.3","4":"0.0000000"},{"1":"0 days","2":"4.125","3":"0.3","4":"0.0000000"},{"1":"0 days","2":"4.875","3":"0.4","4":"0.0000000"},{"1":"0 days","2":"5.625","3":"0.3","4":"0.0000000"},{"1":"0 days","2":"6.375","3":"0.1","4":"0.0000000"},{"1":"0 days","2":"7.125","3":"0.3","4":"0.0000000"},{"1":"0 days","2":"7.875","3":"0.3","4":"0.0000000"},{"1":"0 days","2":"8.625","3":"0.3","4":"0.0000000"},{"1":"0 days","2":"9.375","3":"0.3","4":"0.0000000"},{"1":"0 days","2":"10.125","3":"0.1","4":"0.0000000"},{"1":"0 days","2":"10.875","3":"0.1","4":"0.0000000"},{"1":"0 days","2":"11.625","3":"0.4","4":"0.0000000"},{"1":"0 days","2":"12.375","3":"0.0","4":"0.0000000"},{"1":"0 days","2":"13.125","3":"0.1","4":"0.0000000"},{"1":"0 days","2":"13.875","3":"0.2","4":"0.0000000"},{"1":"0 days","2":"14.625","3":"0.0","4":"0.0000000"},{"1":"51 days","2":"0.375","3":"1.0","4":"0.2916171"},{"1":"51 days","2":"1.125","3":"1.9","4":"0.2916171"},{"1":"51 days","2":"1.875","3":"2.4","4":"0.2916171"},{"1":"51 days","2":"2.625","3":"4.2","4":"0.2916171"},{"1":"51 days","2":"3.375","3":"4.2","4":"0.2916171"},{"1":"51 days","2":"4.125","3":"3.8","4":"0.2916171"},{"1":"51 days","2":"4.875","3":"3.5","4":"0.2916171"},{"1":"51 days","2":"5.625","3":"4.7","4":"0.2916171"},{"1":"51 days","2":"6.375","3":"4.8","4":"0.2916171"},{"1":"51 days","2":"7.125","3":"5.9","4":"0.2916171"},{"1":"51 days","2":"7.875","3":"5.1","4":"0.2916171"},{"1":"51 days","2":"8.625","3":"5.0","4":"0.2916171"},{"1":"51 days","2":"9.375","3":"4.8","4":"0.2916171"},{"1":"51 days","2":"10.125","3":"5.1","4":"0.2916171"},{"1":"51 days","2":"10.875","3":"3.9","4":"0.2916171"},{"1":"51 days","2":"11.625","3":"3.9","4":"0.2916171"},{"1":"51 days","2":"12.375","3":"3.7","4":"0.2916171"},{"1":"51 days","2":"13.125","3":"2.7","4":"0.2916171"},{"1":"51 days","2":"13.875","3":"2.6","4":"0.2916171"},{"1":"51 days","2":"14.625","3":"0.5","4":"0.2916171"},{"1":"96 days","2":"0.375","3":"0.5","4":"0.6023049"},{"1":"96 days","2":"1.125","3":"3.2","4":"0.6023049"},{"1":"96 days","2":"1.875","3":"1.4","4":"0.6023049"},{"1":"96 days","2":"2.625","3":"5.9","4":"0.6023049"},{"1":"96 days","2":"3.375","3":"6.8","4":"0.6023049"},{"1":"96 days","2":"4.125","3":"6.6","4":"0.6023049"},{"1":"96 days","2":"4.875","3":"6.8","4":"0.6023049"},{"1":"96 days","2":"5.625","3":"7.6","4":"0.6023049"},{"1":"96 days","2":"6.375","3":"8.8","4":"0.6023049"},{"1":"96 days","2":"7.125","3":"8.8","4":"0.6023049"},{"1":"96 days","2":"7.875","3":"8.5","4":"0.6023049"},{"1":"96 days","2":"8.625","3":"8.0","4":"0.6023049"},{"1":"96 days","2":"9.375","3":"8.6","4":"0.6023049"},{"1":"96 days","2":"10.125","3":"7.6","4":"0.6023049"},{"1":"96 days","2":"10.875","3":"4.2","4":"0.6023049"},{"1":"96 days","2":"11.625","3":"5.4","4":"0.6023049"},{"1":"96 days","2":"12.375","3":"4.5","4":"0.6023049"},{"1":"96 days","2":"13.125","3":"2.3","4":"0.6023049"},{"1":"96 days","2":"13.875","3":"1.7","4":"0.6023049"},{"1":"96 days","2":"14.625","3":"0.0","4":"0.6023049"},{"1":"104 days","2":"0.375","3":"1.8","4":"0.6434174"},{"1":"104 days","2":"1.125","3":"3.8","4":"0.6434174"},{"1":"104 days","2":"1.875","3":"4.8","4":"0.6434174"},{"1":"104 days","2":"2.625","3":"10.3","4":"0.6434174"},{"1":"104 days","2":"3.375","3":"8.1","4":"0.6434174"},{"1":"104 days","2":"4.125","3":"7.9","4":"0.6434174"},{"1":"104 days","2":"4.875","3":"8.7","4":"0.6434174"},{"1":"104 days","2":"5.625","3":"9.5","4":"0.6434174"},{"1":"104 days","2":"6.375","3":"10.9","4":"0.6434174"},{"1":"104 days","2":"7.125","3":"11.0","4":"0.6434174"},{"1":"104 days","2":"7.875","3":"10.7","4":"0.6434174"},{"1":"104 days","2":"8.625","3":"10.6","4":"0.6434174"},{"1":"104 days","2":"9.375","3":"9.8","4":"0.6434174"},{"1":"104 days","2":"10.125","3":"8.8","4":"0.6434174"},{"1":"104 days","2":"10.875","3":"7.6","4":"0.6434174"},{"1":"104 days","2":"11.625","3":"7.1","4":"0.6434174"},{"1":"104 days","2":"12.375","3":"6.6","4":"0.6434174"},{"1":"104 days","2":"13.125","3":"4.4","4":"0.6434174"},{"1":"104 days","2":"13.875","3":"3.9","4":"0.6434174"},{"1":"104 days","2":"14.625","3":"1.6","4":"0.6434174"},{"1":"107 days","2":"0.375","3":"1.7","4":"0.6654670"},{"1":"107 days","2":"1.125","3":"3.9","4":"0.6654670"},{"1":"107 days","2":"1.875","3":"4.9","4":"0.6654670"},{"1":"107 days","2":"2.625","3":"10.3","4":"0.6654670"},{"1":"107 days","2":"3.375","3":"8.0","4":"0.6654670"},{"1":"107 days","2":"4.125","3":"8.0","4":"0.6654670"},{"1":"107 days","2":"4.875","3":"9.4","4":"0.6654670"},{"1":"107 days","2":"5.625","3":"9.6","4":"0.6654670"},{"1":"107 days","2":"6.375","3":"11.0","4":"0.6654670"},{"1":"107 days","2":"7.125","3":"11.0","4":"0.6654670"},{"1":"107 days","2":"7.875","3":"10.6","4":"0.6654670"},{"1":"107 days","2":"8.625","3":"10.6","4":"0.6654670"},{"1":"107 days","2":"9.375","3":"9.9","4":"0.6654670"},{"1":"107 days","2":"10.125","3":"9.0","4":"0.6654670"},{"1":"107 days","2":"10.875","3":"7.8","4":"0.6654670"},{"1":"107 days","2":"11.625","3":"7.1","4":"0.6654670"},{"1":"107 days","2":"12.375","3":"6.7","4":"0.6654670"},{"1":"107 days","2":"13.125","3":"4.5","4":"0.6654670"},{"1":"107 days","2":"13.875","3":"3.9","4":"0.6654670"},{"1":"107 days","2":"14.625","3":"1.8","4":"0.6654670"},{"1":"121 days","2":"0.375","3":"0.2","4":"0.7549257"},{"1":"121 days","2":"1.125","3":"3.4","4":"0.7549257"},{"1":"121 days","2":"1.875","3":"2.8","4":"0.7549257"},{"1":"121 days","2":"2.625","3":"11.6","4":"0.7549257"},{"1":"121 days","2":"3.375","3":"8.8","4":"0.7549257"},{"1":"121 days","2":"4.125","3":"7.6","4":"0.7549257"},{"1":"121 days","2":"4.875","3":"8.1","4":"0.7549257"},{"1":"121 days","2":"5.625","3":"8.9","4":"0.7549257"},{"1":"121 days","2":"6.375","3":"10.7","4":"0.7549257"},{"1":"121 days","2":"7.125","3":"11.6","4":"0.7549257"},{"1":"121 days","2":"7.875","3":"11.1","4":"0.7549257"},{"1":"121 days","2":"8.625","3":"8.6","4":"0.7549257"},{"1":"121 days","2":"9.375","3":"9.9","4":"0.7549257"},{"1":"121 days","2":"10.125","3":"8.2","4":"0.7549257"},{"1":"121 days","2":"10.875","3":"8.0","4":"0.7549257"},{"1":"121 days","2":"11.625","3":"6.8","4":"0.7549257"},{"1":"121 days","2":"12.375","3":"4.5","4":"0.7549257"},{"1":"121 days","2":"13.125","3":"3.6","4":"0.7549257"},{"1":"121 days","2":"13.875","3":"3.2","4":"0.7549257"},{"1":"121 days","2":"14.625","3":"0.2","4":"0.7549257"},{"1":"138 days","2":"0.375","3":"0.6","4":"0.8742325"},{"1":"138 days","2":"1.125","3":"4.1","4":"0.8742325"},{"1":"138 days","2":"1.875","3":"5.5","4":"0.8742325"},{"1":"138 days","2":"2.625","3":"12.3","4":"0.8742325"},{"1":"138 days","2":"3.375","3":"9.3","4":"0.8742325"},{"1":"138 days","2":"4.125","3":"8.5","4":"0.8742325"},{"1":"138 days","2":"4.875","3":"9.4","4":"0.8742325"},{"1":"138 days","2":"5.625","3":"9.7","4":"0.8742325"},{"1":"138 days","2":"6.375","3":"10.3","4":"0.8742325"},{"1":"138 days","2":"7.125","3":"12.4","4":"0.8742325"},{"1":"138 days","2":"7.875","3":"10.9","4":"0.8742325"},{"1":"138 days","2":"8.625","3":"11.7","4":"0.8742325"},{"1":"138 days","2":"9.375","3":"11.8","4":"0.8742325"},{"1":"138 days","2":"10.125","3":"8.2","4":"0.8742325"},{"1":"138 days","2":"10.875","3":"9.7","4":"0.8742325"},{"1":"138 days","2":"11.625","3":"8.7","4":"0.8742325"},{"1":"138 days","2":"12.375","3":"4.8","4":"0.8742325"},{"1":"138 days","2":"13.125","3":"2.6","4":"0.8742325"},{"1":"138 days","2":"13.875","3":"4.2","4":"0.8742325"},{"1":"138 days","2":"14.625","3":"0.9","4":"0.8742325"},{"1":"158 days","2":"0.375","3":"2.8","4":"1.0137852"},{"1":"158 days","2":"1.125","3":"7.3","4":"1.0137852"},{"1":"158 days","2":"1.875","3":"8.9","4":"1.0137852"},{"1":"158 days","2":"2.625","3":"16.1","4":"1.0137852"},{"1":"158 days","2":"3.375","3":"13.7","4":"1.0137852"},{"1":"158 days","2":"4.125","3":"11.6","4":"1.0137852"},{"1":"158 days","2":"4.875","3":"13.8","4":"1.0137852"},{"1":"158 days","2":"5.625","3":"13.2","4":"1.0137852"},{"1":"158 days","2":"6.375","3":"17.0","4":"1.0137852"},{"1":"158 days","2":"7.125","3":"17.8","4":"1.0137852"},{"1":"158 days","2":"7.875","3":"16.3","4":"1.0137852"},{"1":"158 days","2":"8.625","3":"16.5","4":"1.0137852"},{"1":"158 days","2":"9.375","3":"14.9","4":"1.0137852"},{"1":"158 days","2":"10.125","3":"14.5","4":"1.0137852"},{"1":"158 days","2":"10.875","3":"12.1","4":"1.0137852"},{"1":"158 days","2":"11.625","3":"12.6","4":"1.0137852"},{"1":"158 days","2":"12.375","3":"10.7","4":"1.0137852"},{"1":"158 days","2":"13.125","3":"14.1","4":"1.0137852"},{"1":"158 days","2":"13.875","3":"8.2","4":"1.0137852"},{"1":"158 days","2":"14.625","3":"6.6","4":"1.0137852"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell" data-fig-hight="5">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sup-material-ch6_files/figure-html/belt-c-raw-prof-fig-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption>Wear profile of belt C.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div data-pagedtable="false"> <div class="table-caption"><p>Wear data for belt C.</p></div>
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["operation_time"],"name":[1],"type":["drtn"],"align":["right"]},{"label":["measurement_pos"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["wear"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["tonnes"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"0 days","2":"0.375","3":"0.0","4":"0.0000000"},{"1":"0 days","2":"1.125","3":"0.2","4":"0.0000000"},{"1":"0 days","2":"1.875","3":"0.0","4":"0.0000000"},{"1":"0 days","2":"2.625","3":"0.3","4":"0.0000000"},{"1":"0 days","2":"3.375","3":"0.4","4":"0.0000000"},{"1":"0 days","2":"4.125","3":"0.3","4":"0.0000000"},{"1":"0 days","2":"4.875","3":"0.5","4":"0.0000000"},{"1":"0 days","2":"5.625","3":"0.7","4":"0.0000000"},{"1":"0 days","2":"6.375","3":"0.4","4":"0.0000000"},{"1":"0 days","2":"7.125","3":"0.6","4":"0.0000000"},{"1":"0 days","2":"7.875","3":"0.5","4":"0.0000000"},{"1":"0 days","2":"8.625","3":"0.6","4":"0.0000000"},{"1":"0 days","2":"9.375","3":"0.3","4":"0.0000000"},{"1":"0 days","2":"10.125","3":"0.5","4":"0.0000000"},{"1":"0 days","2":"10.875","3":"0.5","4":"0.0000000"},{"1":"0 days","2":"11.625","3":"0.3","4":"0.0000000"},{"1":"0 days","2":"12.375","3":"0.4","4":"0.0000000"},{"1":"0 days","2":"13.125","3":"0.2","4":"0.0000000"},{"1":"0 days","2":"13.875","3":"0.4","4":"0.0000000"},{"1":"0 days","2":"14.625","3":"0.1","4":"0.0000000"},{"1":"43 days","2":"0.375","3":"0.0","4":"0.1726939"},{"1":"43 days","2":"1.125","3":"0.7","4":"0.1726939"},{"1":"43 days","2":"1.875","3":"1.7","4":"0.1726939"},{"1":"43 days","2":"2.625","3":"0.7","4":"0.1726939"},{"1":"43 days","2":"3.375","3":"0.2","4":"0.1726939"},{"1":"43 days","2":"4.125","3":"0.8","4":"0.1726939"},{"1":"43 days","2":"4.875","3":"0.7","4":"0.1726939"},{"1":"43 days","2":"5.625","3":"2.0","4":"0.1726939"},{"1":"43 days","2":"6.375","3":"1.9","4":"0.1726939"},{"1":"43 days","2":"7.125","3":"1.7","4":"0.1726939"},{"1":"43 days","2":"7.875","3":"1.8","4":"0.1726939"},{"1":"43 days","2":"8.625","3":"0.8","4":"0.1726939"},{"1":"43 days","2":"9.375","3":"1.7","4":"0.1726939"},{"1":"43 days","2":"10.125","3":"1.4","4":"0.1726939"},{"1":"43 days","2":"10.875","3":"1.6","4":"0.1726939"},{"1":"43 days","2":"11.625","3":"1.7","4":"0.1726939"},{"1":"43 days","2":"12.375","3":"0.5","4":"0.1726939"},{"1":"43 days","2":"13.125","3":"1.6","4":"0.1726939"},{"1":"43 days","2":"13.875","3":"2.9","4":"0.1726939"},{"1":"43 days","2":"14.625","3":"1.4","4":"0.1726939"},{"1":"63 days","2":"0.375","3":"1.8","4":"0.2953100"},{"1":"63 days","2":"1.125","3":"3.1","4":"0.2953100"},{"1":"63 days","2":"1.875","3":"3.3","4":"0.2953100"},{"1":"63 days","2":"2.625","3":"4.8","4":"0.2953100"},{"1":"63 days","2":"3.375","3":"5.2","4":"0.2953100"},{"1":"63 days","2":"4.125","3":"5.6","4":"0.2953100"},{"1":"63 days","2":"4.875","3":"6.7","4":"0.2953100"},{"1":"63 days","2":"5.625","3":"7.6","4":"0.2953100"},{"1":"63 days","2":"6.375","3":"7.8","4":"0.2953100"},{"1":"63 days","2":"7.125","3":"7.6","4":"0.2953100"},{"1":"63 days","2":"7.875","3":"7.5","4":"0.2953100"},{"1":"63 days","2":"8.625","3":"7.2","4":"0.2953100"},{"1":"63 days","2":"9.375","3":"7.1","4":"0.2953100"},{"1":"63 days","2":"10.125","3":"6.8","4":"0.2953100"},{"1":"63 days","2":"10.875","3":"5.8","4":"0.2953100"},{"1":"63 days","2":"11.625","3":"5.4","4":"0.2953100"},{"1":"63 days","2":"12.375","3":"4.2","4":"0.2953100"},{"1":"63 days","2":"13.125","3":"4.0","4":"0.2953100"},{"1":"63 days","2":"13.875","3":"6.9","4":"0.2953100"},{"1":"63 days","2":"14.625","3":"5.5","4":"0.2953100"},{"1":"91 days","2":"0.375","3":"0.0","4":"0.4766580"},{"1":"91 days","2":"1.125","3":"1.7","4":"0.4766580"},{"1":"91 days","2":"1.875","3":"2.4","4":"0.4766580"},{"1":"91 days","2":"2.625","3":"2.9","4":"0.4766580"},{"1":"91 days","2":"3.375","3":"4.0","4":"0.4766580"},{"1":"91 days","2":"4.125","3":"4.0","4":"0.4766580"},{"1":"91 days","2":"4.875","3":"3.8","4":"0.4766580"},{"1":"91 days","2":"5.625","3":"5.2","4":"0.4766580"},{"1":"91 days","2":"6.375","3":"5.7","4":"0.4766580"},{"1":"91 days","2":"7.125","3":"7.2","4":"0.4766580"},{"1":"91 days","2":"7.875","3":"7.7","4":"0.4766580"},{"1":"91 days","2":"8.625","3":"7.1","4":"0.4766580"},{"1":"91 days","2":"9.375","3":"5.8","4":"0.4766580"},{"1":"91 days","2":"10.125","3":"6.1","4":"0.4766580"},{"1":"91 days","2":"10.875","3":"6.1","4":"0.4766580"},{"1":"91 days","2":"11.625","3":"4.3","4":"0.4766580"},{"1":"91 days","2":"12.375","3":"3.2","4":"0.4766580"},{"1":"91 days","2":"13.125","3":"2.1","4":"0.4766580"},{"1":"91 days","2":"13.875","3":"3.8","4":"0.4766580"},{"1":"91 days","2":"14.625","3":"4.7","4":"0.4766580"},{"1":"146 days","2":"0.375","3":"0.4","4":"0.8810857"},{"1":"146 days","2":"1.125","3":"4.6","4":"0.8810857"},{"1":"146 days","2":"1.875","3":"5.5","4":"0.8810857"},{"1":"146 days","2":"2.625","3":"8.0","4":"0.8810857"},{"1":"146 days","2":"3.375","3":"8.4","4":"0.8810857"},{"1":"146 days","2":"4.125","3":"8.9","4":"0.8810857"},{"1":"146 days","2":"4.875","3":"8.0","4":"0.8810857"},{"1":"146 days","2":"5.625","3":"11.5","4":"0.8810857"},{"1":"146 days","2":"6.375","3":"12.6","4":"0.8810857"},{"1":"146 days","2":"7.125","3":"14.7","4":"0.8810857"},{"1":"146 days","2":"7.875","3":"15.3","4":"0.8810857"},{"1":"146 days","2":"8.625","3":"13.4","4":"0.8810857"},{"1":"146 days","2":"9.375","3":"13.4","4":"0.8810857"},{"1":"146 days","2":"10.125","3":"12.1","4":"0.8810857"},{"1":"146 days","2":"10.875","3":"10.9","4":"0.8810857"},{"1":"146 days","2":"11.625","3":"9.8","4":"0.8810857"},{"1":"146 days","2":"12.375","3":"5.7","4":"0.8810857"},{"1":"146 days","2":"13.125","3":"5.5","4":"0.8810857"},{"1":"146 days","2":"13.875","3":"11.0","4":"0.8810857"},{"1":"146 days","2":"14.625","3":"6.7","4":"0.8810857"},{"1":"179 days","2":"0.375","3":"4.0","4":"1.1312397"},{"1":"179 days","2":"1.125","3":"5.7","4":"1.1312397"},{"1":"179 days","2":"1.875","3":"8.3","4":"1.1312397"},{"1":"179 days","2":"2.625","3":"8.7","4":"1.1312397"},{"1":"179 days","2":"3.375","3":"9.5","4":"1.1312397"},{"1":"179 days","2":"4.125","3":"9.7","4":"1.1312397"},{"1":"179 days","2":"4.875","3":"11.7","4":"1.1312397"},{"1":"179 days","2":"5.625","3":"14.2","4":"1.1312397"},{"1":"179 days","2":"6.375","3":"17.5","4":"1.1312397"},{"1":"179 days","2":"7.125","3":"17.8","4":"1.1312397"},{"1":"179 days","2":"7.875","3":"17.0","4":"1.1312397"},{"1":"179 days","2":"8.625","3":"16.0","4":"1.1312397"},{"1":"179 days","2":"9.375","3":"15.2","4":"1.1312397"},{"1":"179 days","2":"10.125","3":"14.9","4":"1.1312397"},{"1":"179 days","2":"10.875","3":"13.0","4":"1.1312397"},{"1":"179 days","2":"11.625","3":"8.8","4":"1.1312397"},{"1":"179 days","2":"12.375","3":"6.8","4":"1.1312397"},{"1":"179 days","2":"13.125","3":"7.1","4":"1.1312397"},{"1":"179 days","2":"13.875","3":"12.3","4":"1.1312397"},{"1":"179 days","2":"14.625","3":"10.1","4":"1.1312397"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="a-typical-way-of-forecasting-belt-wear" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="a-typical-way-of-forecasting-belt-wear"><span class="header-section-number">2</span> A typical way of forecasting belt wear</h2>
<p>To manage the reliability of the conveyor, engineers will typicaly specify a “soft failure threashold” which indicates the functional failure of the belt. They then try to forecast the belts wear to estimate when this soft failure will ocure in order to plan the replacement of the belt ahead of time.</p>
<p>Even though these belt wear data sets only have a few observations each, the observations themselves are fairly complicated. Our natural instincted when confronted with complex observations is to reduce the complexity so that we can use forecasting methods that we are famiar with. This approach is cominaly taken in practice when dealing with conveyor belt wear data. Bellow we show two typical aproaches used to forecast belt wear. Both use linear regression, the first uses the measurements from the fastest wearing location along the belts cross section as in <span class="citation" data-cites="webb_2020">Webb et al. (<a href="#ref-webb_2020" role="doc-biblioref">2020</a>)</span>, while the second uses the maximum wear measurement from each profile-an approach used in many condition monitoring software.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Fastest wearing location</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Greatest wear measurements</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sup-material-ch6_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="sup-material-ch6_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>For both of these linear approaches to forecasting wear, we can see that the future measurements have been over-predicted. But even more importantly, because we do not understand the distribution of these measurements, we have no way of quantifying our prediction uncertainty. In the remainder of this markdaown document we introduce a method that uses the entire wear profile to inform a pricipled model for belt wear, which allows us to properly quantify our uncertainty when forecasting the wear profile.</p>
</section>
<section id="our-models" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="our-models"><span class="header-section-number">3</span> Our models</h2>
<p>The Bayesian hierarchical models for belt wear, which we implement and fit in the probabalistic programing language <code>Stan</code>, are <strong>Gamma process</strong> <span id="eq-data-model-gp"><span class="math display">\[
\begin{align*}
z_{i, n}|\underline{y}_{i}, \sigma \sim &amp; N(f_i(n), \sigma)               &amp;&amp; \text{Data model: FDA} \\
f_i(n) =                                &amp; \sum^{M}_{i = 1}b_m(n)y_{i, m}                            \\
\end{align*}
\tag{1}\]</span></span></p>
<p><span id="eq-process-model-gp"><span class="math display">\[
\begin{align*}
y_{i, m}|y^*_{i, m}, \phi \sim &amp; t_{10} (y^*_{i, m}, \phi y^*_{i, m}) &amp;&amp; \text{Process model: Noisy GP}   \\
\Delta y^*_{i, m} = &amp; y^*_{i, m} - y^*_{i - 1, m}                                                         \\
\Delta y_{i, m}|\mu_m, \nu_m \sim &amp; Ga \left( \frac{\Delta t_i}{\nu_m^2}, \frac{1}{\mu_m \nu_m^2} \right)
\end{align*}
\tag{2}\]</span></span></p>
<p><span id="eq-param-model-gp"><span class="math display">\[
\begin{align*}
\sigma \sim     &amp; U(0, A)                 &amp;&amp; \text{Parameter model: Priors} \\
\phi \sim       &amp; Cauch^{+}(0, 5)                                           \\
\nu_m \sim      &amp; N(\nu_{mean}, \nu_{sd})                                   \\
\nu_{mean} \sim &amp; t_3^{+}(0, 0.5)                                           \\
\nu_{sd} \sim   &amp; Cauch^{+}(0, 0.25)                                        \\
\mu_m \sim      &amp; N(\hat{a}_m, \hat{b}_m)
\end{align*}
\tag{3}\]</span></span></p>
<p>where <span class="math inline">\(\Delta y^*_{i, m} = y^*_{i, m} - y^*_{i - 1, m}\)</span> and <span class="math inline">\(\Delta t_{i} = t_{i} - t_{i - 1}\)</span> and <strong>Linear path</strong> <span id="eq-data-model-lm"><span class="math display">\[
\begin{align*}
z_{i, n}|\underline{y}_{i}, \sigma \sim &amp; N(f_i(n), \sigma)               &amp;&amp; \text{Data model: FDA} \\
f_i(n) =                                &amp; \sum^{M}_{i = 1}b_m(n)y_{i, m}
\end{align*}
\tag{4}\]</span></span></p>
<p><span id="eq-process-model-lm"><span class="math display">\[
\begin{align*}
y_{i, m}|y^*_{i, m}, \phi \sim &amp; t_{10} (y^*_{i, m}, \phi y^*_{i, m}) &amp;&amp; \text{Process model: Noisy GP} \\
y^*_{i, m} = &amp; \mu_m t_i
\end{align*}
\tag{5}\]</span></span></p>
<p><span id="eq-param-model-lm"><span class="math display">\[
\begin{align*}
\sigma \sim     &amp; U(0, A)                 &amp;&amp; \text{Parameter model: Priors} \\
\phi \sim       &amp; Cauch^{+}(0, 5)                                           \\
\mu_m \sim      &amp; N(\hat{a}_m, \hat{b}_m).
\end{align*}
\tag{6}\]</span></span></p>
<p>Information about the notation as well as the intricasies regarding Bayesian heirarchical modeling, functional data alaysis (FDA), the noisy gamma process (GP), and choise of prior distributions are contained in chapter 6 of the main thesis.</p>
<section id="b-spline-design-matrix" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="b-spline-design-matrix"><span class="header-section-number">3.1</span> B-spline design matrix</h3>
<p>In the first level of the hierarchical models (in <a href="#eq-data-model-gp" class="quarto-xref">Equation&nbsp;1</a> and <a href="#eq-data-model-lm" class="quarto-xref">Equation&nbsp;4</a>), we takes a functional interpretation of the UT measurements across the surface of the belt. That is, we asssume that the measurements are noisy observations of a smooth underlying function. We describe this smooth function using a B-spline. <a href="#fig-B-spline-demo-1" class="quarto-xref">Figure&nbsp;2 (a)</a> shows the functional interpretation for the fith observation of <code>Belt_A</code>. The B-spline is composed of the weighted sum of a set of B-spline basis functions, we can see the weighted basis functions is <a href="#fig-B-spline-demo-2" class="quarto-xref">Figure&nbsp;2 (b)</a> and the unweighted basis functions in <a href="#fig-B-spline-demo-3" class="quarto-xref">Figure&nbsp;2 (c)</a>.</p>
<div id="fig-B-spline-demo" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-B-spline-demo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-B-spline-demo" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-B-spline-demo-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-B-spline-demo-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-B-spline-demo-1.png" class="img-fluid figure-img" data-ref-parent="fig-B-spline-demo" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-B-spline-demo-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Fitted B-spline
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-B-spline-demo" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-B-spline-demo-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-B-spline-demo-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-B-spline-demo-2.png" class="img-fluid figure-img" data-ref-parent="fig-B-spline-demo" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-B-spline-demo-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Weighted basis functions
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-B-spline-demo" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-B-spline-demo-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-B-spline-demo-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-B-spline-demo-3.png" class="img-fluid figure-img" data-ref-parent="fig-B-spline-demo" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-B-spline-demo-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Unweighted basis functions
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-B-spline-demo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Fitted B-spline and basis funcitons for the fith observation of Belt_A.
</figcaption>
</figure>
</div>
<p>However, we cant fit estimate the spline coeficients-the weights of the basis functions-using the continuous forms of the basis functions. To estimate the spline coeficients we the design matrix, a matrix containing the values of the basis functions at each discrete measurement location. We use the <code>splines2</code> package to do this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>numb_knots <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">bSpline</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">15</span>, <span class="at">length.out =</span> <span class="dv">22</span>),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">knots =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">14</span>, <span class="at">length.out =</span> numb_knots),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">degree =</span> <span class="dv">3</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">intercept =</span> T)[, <span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math display">\[
B = \begin{matrix}0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0 \\0.34&amp;0.03&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0 \\0.6&amp;0.2&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0 \\0.46&amp;0.48&amp;0.04&amp;0&amp;0&amp;0&amp;0&amp;0 \\0.2&amp;0.64&amp;0.17&amp;0&amp;0&amp;0&amp;0&amp;0 \\0.05&amp;0.54&amp;0.4&amp;0.01&amp;0&amp;0&amp;0&amp;0 \\0&amp;0.3&amp;0.62&amp;0.08&amp;0&amp;0&amp;0&amp;0 \\0&amp;0.1&amp;0.64&amp;0.25&amp;0&amp;0&amp;0&amp;0 \\0&amp;0.02&amp;0.45&amp;0.5&amp;0.03&amp;0&amp;0&amp;0 \\0&amp;0&amp;0.21&amp;0.66&amp;0.13&amp;0&amp;0&amp;0 \\0&amp;0&amp;0.06&amp;0.59&amp;0.35&amp;0&amp;0&amp;0 \\0&amp;0&amp;0&amp;0.35&amp;0.59&amp;0.06&amp;0&amp;0 \\0&amp;0&amp;0&amp;0.13&amp;0.66&amp;0.21&amp;0&amp;0 \\0&amp;0&amp;0&amp;0.03&amp;0.5&amp;0.45&amp;0.02&amp;0 \\0&amp;0&amp;0&amp;0&amp;0.25&amp;0.64&amp;0.1&amp;0 \\0&amp;0&amp;0&amp;0&amp;0.08&amp;0.62&amp;0.3&amp;0 \\0&amp;0&amp;0&amp;0&amp;0.01&amp;0.4&amp;0.54&amp;0.05 \\0&amp;0&amp;0&amp;0&amp;0&amp;0.17&amp;0.64&amp;0.2 \\0&amp;0&amp;0&amp;0&amp;0&amp;0.04&amp;0.48&amp;0.46 \\0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0.2&amp;0.6 \\0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0.03&amp;0.34 \\0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0 \\\end{matrix}
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dropped basis functions
</div>
</div>
<div class="callout-body-container callout-body">
<p>We have dropped some basis functions at the edges. We do this because we wish to constrain how “wigly” the spline can be at the edge of the belt, and also because we want the spline to be ancoured at 0 at the edges.</p>
</div>
</div>
</section>
<section id="sec-informative-priors" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="sec-informative-priors"><span class="header-section-number">3.2</span> Informative prior</h3>
<p>The two process models in <a href="#eq-process-model-gp" class="quarto-xref">Equation&nbsp;2</a> and <a href="#eq-process-model-lm" class="quarto-xref">Equation&nbsp;5</a> are set up so that we can encode information about the mean wear rate of spline coefficients by placing informative priors on the <span class="math inline">\(\mu_m\)</span>. This means that we can supliment the analysis with past data or domain expert knowledge. We have two previouse belt lives–<code>Belt_B</code> and <code>Belt_C</code>– which we can use to construct an informative prior for the <span class="math inline">\(\mu_m\)</span>. We can crudely estemate the mean degradation of the coeficients by fitting splines to each of the observations from the two historic belts and then fitting linear models to the relationship between the ceofficients values and tonnes. <a href="#fig-estimated-coefs" class="quarto-xref">Figure&nbsp;3</a> below shows the estimated linear fits.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-estimated-coefs" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-estimated-coefs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-estimated-coefs-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-estimated-coefs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Estimating mean wear rate of the spline paramters from historic belt data to construct an informative prior for <span class="math inline">\(\mu_m\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The prior for the <span class="math inline">\(\mu_m\)</span> are normaly distributed. Therefore to compose a mildly informative prior, we set the mean of these distributions to the estimated slope of the linear fit and the standard deviation to the distribution to be five times the standard deviation of the estimated slopes.</p>
</section>
<section id="prior-predictive-checks" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="prior-predictive-checks"><span class="header-section-number">3.3</span> Prior predictive checks</h3>
<p>Now that we have specified the full prior model in the form of a group of marginal distributions, each of the marginal priors make sense on their own, but it is important to make sure that the prior we have specified encodes what we intended in the space of the data. To check this we can use prior predictive checking <span class="citation" data-cites="gabry_vis_2019">Gabry et al. (<a href="#ref-gabry_vis_2019" role="doc-biblioref">2019</a>)</span>. Using the informative prior developed for <span class="math inline">\(\mu_m\)</span> in the previous section and the specified priors for the other parameters in <a href="#eq-param-model-gp" class="quarto-xref">Equation&nbsp;3</a> and <a href="#eq-param-model-lm" class="quarto-xref">Equation&nbsp;6</a>, we can simulate data from our Bayesian model and then visualise this data to check that our specified priors encode what we originaly intended.</p>
<p>The priors that we have specified for the varinace parameters are extreemly vaigue, and so we only perform prior predictive checks for the “non-noisy” wear profiles. In <a href="#fig-ppc" class="quarto-xref">Figure&nbsp;4</a> below, we simulate sixteen fictitious belt wear data sets from the prior.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ppc" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ppc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-ppc-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ppc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Sixteen synthetic non-noisy belt wear data sets generated using the prior, otherwise known as prior predictive checks.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Out of the sixteen prior predictive realisations in <a href="#fig-ppc" class="quarto-xref">Figure&nbsp;4</a>, roughly twelve of them look like feasible beltwear data sets. Of the few that do not look feisible, two profiles have unreasonable scales (more than a 100mm jump in wear) and the remainder don’t look feisable because of a lack of larege scale spacial corelation. This last point regarding the lack of spatial corelation is a charecteristic of the models structue, not the prior. We have not included any spacial dependance in the model for the spline coeficients, but this will be explored in future work. Considering that only two of the simulated data sets look completely unreasonable based on our understanding of the data generateing mechanism, we consider this prior to be a sufficient weekly informative prior for the analysis.</p>
</section>
</section>
<section id="stan-models" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="stan-models"><span class="header-section-number">4</span> Stan models</h2>
<p>To fit the model we use the probabalistic programing language Stan <span class="citation" data-cites="Stan2022">(<a href="#ref-Stan2022" role="doc-biblioref">Stan Development Team 2022</a>)</span>. Bellow I define each of the</p>
<section id="lm" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="lm"><span class="header-section-number">4.1</span> LM</h3>
<div class="cell" data-output.var="fda_LM_stan_model">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span>{</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">// data //</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> I;           <span class="co">// number of observations</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> N;           <span class="co">// number of measurement locations</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> M;           <span class="co">// number of spline basis</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="dt">vector</span>[I] t;     <span class="co">// the set of observation times</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="dt">matrix</span>[I, N] z;  <span class="co">// the set of noisy UT measurements</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="dt">matrix</span>[N, M] B;  <span class="co">// the B-spline design matrix</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">// hyper parameters for mu //</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="dt">vector</span>[M] a_hat; <span class="co">// our estimate of the mean wear rate</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="dt">vector</span>[M] b_hat; <span class="co">// our uncertanty of this estimate</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span>{</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="dt">vector</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt;[M] mu;            <span class="co">// the mean wear rates of the gamma processes</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; sigma;              <span class="co">// the standard deviation of the measurement error at UT level</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; phi;                <span class="co">// the standard deviation of the measurement error at coef level</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="dt">matrix</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt;[I, M] y_noisy;    <span class="co">// the filtered values of the spline coeficients</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed parameters</span>{</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="dt">matrix</span>[I, N] z_hat;                 <span class="co">// smoothed UT observations (functional obs)</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="dt">matrix</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt;[I, M] y;          <span class="co">// the filtered values of the spline coeficients</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">// calculate the mean degradation at time t</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>y = t * mu';</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">1</span>, ] = y[<span class="dv">1</span>, ] + <span class="fl">0.0001</span>;</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co">// calculate value of spline at measurement locations</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>z_hat = y_noisy * B';</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span>{</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="co">/// priors ///</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="co">// for process model</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="co">// mu</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span>:M) {</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  mu[m] ~ normal(a_hat[m], b_hat[m]);</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co">// phi</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>phi ~ cauchy(<span class="dv">0</span>, <span class="dv">25</span>);</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co">// sigma</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>sigma ~ uniform(<span class="dv">0</span>, <span class="dv">100</span>);</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="co">/// linear model ///</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:I) {</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  y_noisy[i, ] ~ student_t(<span class="dv">10</span>, y[i, ], y[i, ]*phi);</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="co">/// data model ///</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:I) {</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>  z[i, ] ~ normal(z_hat[i, ], sigma);</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="gp" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="gp"><span class="header-section-number">4.2</span> GP</h3>
<p>Below the BHM in <a href="#eq-data-model-gp" class="quarto-xref">Equation&nbsp;1</a>, <a href="#eq-param-model-gp" class="quarto-xref">Equation&nbsp;3</a>, and <a href="#eq-process-model-gp" class="quarto-xref">Equation&nbsp;2</a> is specified in Stan.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Parameterisation of <span class="math inline">\(\nu\)</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>For computational reasons we use a reparameterisation of the student-t distribution recomended in the <a href="https://mc-stan.org/docs/stan-users-guide/reparameterization.html#reparameterizing-a-student-t-distribution">Stan user manual</a>.</p>
</div>
</div>
<div class="cell" data-output.var="fda_noisy_GP_stan_model">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span>{</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">// data //</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> I;           <span class="co">// number of observations</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> N;           <span class="co">// number of measurement locations</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> M;           <span class="co">// number of spline basis</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="dt">vector</span>[I] t;     <span class="co">// the set of observation times</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="dt">matrix</span>[I, N] z;  <span class="co">// the set of noisy UT measurements</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="dt">matrix</span>[N, M] B;  <span class="co">// the B-spline design matrix</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">// hyper parameters for mu //</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="dt">vector</span>[M] a_hat; <span class="co">// our estimate of the mean wear rate</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="dt">vector</span>[M] b_hat; <span class="co">// our uncertanty of this estimate</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed data</span>{</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="dt">vector</span>[I - <span class="dv">1</span>] t_diff;              <span class="co">// The time steps between each observation</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">// calculate the time steps //</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>t_diff = t[<span class="dv">2</span>:I] - t[<span class="dv">1</span>:I<span class="dv">-1</span>];</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span>{</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="dt">vector</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt;[M] mu;            <span class="co">// the mean wear rates of the gamma processes</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; nu_a;               <span class="co">// reparam of t_3 prior for nu</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; nu_b;               <span class="co">// ""</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; nu_sd;              <span class="co">// the sd of the random effect on nu</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="dt">vector</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt;[M] nu;            <span class="co">// CoVs of the gamma processes</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; sigma;              <span class="co">// the standard deviation of the measurement error at UT level</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; phi;                <span class="co">// the standard deviation of the measurement error at coef level</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="dt">matrix</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt;[I - <span class="dv">1</span>, M] y_diff; <span class="co">// the jumps in degradation of each coeficient</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="dt">matrix</span>[I - <span class="dv">1</span>, M] y_noisy;           <span class="co">// the noisy coeficient values</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed parameters</span>{</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt; nu_mean;             <span class="co">// the mean of the random effect on nu</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="dt">matrix</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>&gt;[I - <span class="dv">1</span>, M] y;       <span class="co">// the filtered values of the spline coeficients</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="dt">matrix</span>[I, N] z_hat;                  <span class="co">// smoothed UT observations (functional obs)</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="co">// reparam of nu_mean</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>nu_mean = nu_a / sqrt(nu_b);</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="co">// calculate the coef values from the stochastic jumps</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span>:M) {</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  y[, m] = cumulative_sum(y_diff[, m]);</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="co">// asume the belt is flat at time zero</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:N){</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  z_hat[<span class="dv">1</span>, n] = <span class="dv">0</span>;</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a><span class="co">// calculate value of spline at measurement locations</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>z_hat[<span class="dv">2</span>:I, ] = y_noisy * B';</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span>{</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a><span class="co">/// priors ///</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a><span class="co">// for process model</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="co">// nu</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>nu_a ~ normal(<span class="dv">0</span>, <span class="fl">0.5</span>);</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>nu_b ~ gamma((<span class="fl">0.5</span> * <span class="dv">3</span>), (<span class="fl">0.5</span> * <span class="dv">3</span>));</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>nu_sd ~ cauchy(<span class="dv">0</span>, <span class="fl">0.5</span>);</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>nu ~ normal(nu_mean, nu_sd);</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a><span class="co">// mu</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span>:M) {</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>  mu[m] ~ normal(a_hat[m], b_hat[m]);</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a><span class="co">// for data model</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>sigma ~ uniform(<span class="dv">0</span>, <span class="dv">100</span>);</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>phi ~ cauchy(<span class="dv">0</span>, <span class="dv">25</span>);</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a><span class="co">/// process model ///</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a><span class="co">// GP </span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a><span class="co">// |the average wear rate parameter is applied in the next |</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a><span class="co">// |step, but is equivelant to scale = 1 / (mu * nu^2)     |</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span>:M){</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>  y_diff[, m] ~ gamma(t_diff / pow(nu[m], <span class="dv">2</span>), <span class="dv">1</span> / (pow(nu[m], <span class="dv">2</span>)));</span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a><span class="co">// Noisy obs</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:(I - <span class="dv">1</span>)){</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span>:M){</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>    y_noisy[i, m] ~ student_t(<span class="dv">10</span>, mu[m] * y[i, m], (phi * mu[m] * y[i, m]));</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a><span class="co">/// data model ///</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:I) {</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>  z[i, ] ~ normal(z_hat[i, ], sigma);</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="sampling" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="sampling"><span class="header-section-number">5</span> Sampling</h2>
<p>Now that we have specified the model is Stan, we can used the no-U-turn MCMC sampler to obtain draws from the posterior. Below we generate X draws from the posterior using 4 chains each 3000 iterations in length with a burn in of 1000 and no thinning.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Arange data in list for Stan</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>stan_data_full <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">I =</span> <span class="fu">length</span>(t[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>]),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">ncol</span>(Ut_matrix),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">M =</span> <span class="fu">ncol</span>(B),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">t =</span> t[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>],</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> Ut_matrix[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, ],</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> B[<span class="dv">2</span><span class="sc">:</span><span class="dv">21</span>, ],</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">a_hat =</span> <span class="fu">lapply</span>(coef_lm_fits, <span class="cf">function</span>(m) m[<span class="st">"a_hat"</span>]) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>(),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">b_hat =</span> <span class="fu">lapply</span>(coef_lm_fits, <span class="cf">function</span>(m) m[<span class="st">"b_hat"</span>]) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>() <span class="sc">*</span> <span class="dv">5</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">GP</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">LM</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>stan_fit_full_gp <span class="ot">&lt;-</span> <span class="fu">sampling</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  fda_noisy_GP_stan_model,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  stan_data_full,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">adapt_delta =</span> <span class="fl">0.99</span>, </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_treedepth =</span> <span class="dv">14</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>stan_fit_full_lm <span class="ot">&lt;-</span> <span class="fu">sampling</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  fda_LM_stan_model,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  stan_data_full,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">adapt_delta =</span> <span class="fl">0.99</span>, </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_treedepth =</span> <span class="dv">14</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>As a first pass check, we can look at the summaries of the main parameters and some simple sampling diagnostic values such as effective sample size and <span class="math inline">\(\hat{R}\)</span> <span class="citation" data-cites="BDA2020">(<a href="#ref-BDA2020" role="doc-biblioref">Gelman et al. 2020, 285–87</a>)</span>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">GP</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">LM</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["summary.mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["summary.se_mean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["summary.sd"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["summary.n_eff"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["summary.Rhat"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.37759392","2":"0.0003643479","3":"0.02539928","4":"4859.7106","5":"1.000926","_rn_":"sigma"},{"1":"0.21936452","2":"0.0014490897","3":"0.04467007","4":"950.2608","5":"1.000559","_rn_":"phi"},{"1":"4.59698354","2":"0.0172024358","3":"1.14259234","4":"4411.6670","5":"1.002674","_rn_":"mu[1]"},{"1":"8.09721953","2":"0.0484726255","3":"2.38996371","4":"2431.0256","5":"1.001495","_rn_":"mu[2]"},{"1":"7.59256671","2":"0.0161639869","3":"1.67132315","4":"10691.1366","5":"1.000223","_rn_":"mu[3]"},{"1":"16.37464358","2":"0.0788536880","3":"2.38947793","4":"918.2523","5":"1.004791","_rn_":"mu[4]"},{"1":"14.97158756","2":"0.0270186454","3":"2.03355458","4":"5664.7992","5":"1.000511","_rn_":"mu[5]"},{"1":"13.32965081","2":"0.0273601712","3":"2.51729626","4":"8465.0795","5":"1.000044","_rn_":"mu[6]"},{"1":"7.87583801","2":"0.0300609902","3":"2.02254717","4":"4526.7942","5":"1.001614","_rn_":"mu[7]"},{"1":"4.75997699","2":"0.0276888761","3":"1.69138777","4":"3731.4336","5":"1.000645","_rn_":"mu[8]"},{"1":"0.15587679","2":"0.0050554667","3":"0.09433982","4":"348.2311","5":"1.012140","_rn_":"nu[1]"},{"1":"0.16405660","2":"0.0059191425","3":"0.10039429","4":"287.6739","5":"1.014788","_rn_":"nu[2]"},{"1":"0.17741658","2":"0.0061904035","3":"0.10612925","4":"293.9221","5":"1.011793","_rn_":"nu[3]"},{"1":"0.14922086","2":"0.0049900731","3":"0.08997456","4":"325.1065","5":"1.010568","_rn_":"nu[4]"},{"1":"0.14240080","2":"0.0045978073","3":"0.08305632","4":"326.3201","5":"1.013094","_rn_":"nu[5]"},{"1":"0.16850657","2":"0.0054100526","3":"0.09724028","4":"323.0646","5":"1.010958","_rn_":"nu[6]"},{"1":"0.17205535","2":"0.0057232230","3":"0.10552443","4":"339.9576","5":"1.009983","_rn_":"nu[7]"},{"1":"0.16659517","2":"0.0053368871","3":"0.10190824","4":"364.6218","5":"1.012718","_rn_":"nu[8]"},{"1":"0.16163375","2":"0.0053033801","3":"0.08157286","4":"236.5843","5":"1.016844","_rn_":"nu_mean"},{"1":"0.06172996","2":"0.0023109097","3":"0.05605798","4":"588.4491","5":"1.004099","_rn_":"nu_sd"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["summary.mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["summary.se_mean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["summary.sd"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["summary.n_eff"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["summary.Rhat"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.3769641","2":"0.0002725374","3":"0.02518198","4":"8537.441","5":"0.9999990","_rn_":"sigma"},{"1":"0.2630436","2":"0.0005514993","3":"0.03790482","4":"4723.881","5":"1.0006897","_rn_":"phi"},{"1":"4.3387966","2":"0.0083680430","3":"0.68908028","4":"6780.970","5":"0.9998416","_rn_":"mu[1]"},{"1":"7.4058881","2":"0.0132107414","3":"1.07535690","4":"6625.992","5":"1.0005835","_rn_":"mu[2]"},{"1":"7.7752403","2":"0.0115772396","3":"1.05369216","4":"8283.568","5":"1.0009215","_rn_":"mu[3]"},{"1":"16.3418027","2":"0.0152821117","3":"1.61243892","4":"11132.682","5":"1.0002568","_rn_":"mu[4]"},{"1":"15.7145967","2":"0.0134778919","3":"1.40675473","4":"10894.137","5":"1.0002432","_rn_":"mu[5]"},{"1":"14.2512915","2":"0.0158010325","3":"1.56738834","4":"9839.710","5":"0.9998405","_rn_":"mu[6]"},{"1":"8.7448687","2":"0.0172558612","3":"1.27760089","4":"5481.724","5":"1.0001756","_rn_":"mu[7]"},{"1":"4.5700669","2":"0.0127410986","3":"0.87161166","4":"4679.854","5":"1.0005968","_rn_":"mu[8]"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
</div>
</div>
<p>To assume that the samples sufficiently represent the target distribution the value of <span class="math inline">\(\hat{R}\)</span> should be less than <span class="math inline">\(1.05\)</span> and there should be at least <span class="math inline">\(10\)</span> effective samples per chain <span class="citation" data-cites="BDA2020">(<a href="#ref-BDA2020" role="doc-biblioref">Gelman et al. 2020, 287</a>)</span>.</p>
<p>Finaly, there was a few divergencies during sampling (about <span class="math inline">\(0.9\%\)</span> of the total number of draws). We can use a parallel coordinate plot with the divergent transitions plotted in red to see if these divergencies are a problem. If the divergent paths show a a clear structure through parameter space then this is a sign that there is degenerate behavior in the posterior. There is signs of two structures, one set that passes through values of <span class="math inline">\(\nu_{sd}\)</span> very close to zero, and another that draws a clear line through parameter space. I believe that the troublesome sampling when <span class="math inline">\(\nu_{sd}\)</span> is close to zero is a fairly typical issue with the variance of random effects when the data do not clearly demonstrate the existence of such an effect-e.g.&nbsp;it is possible that all spline coefficients have the same value of <span class="math inline">\(\nu\)</span>, meaning that the variance of the random effect would be zero. The second clear structure through parameter space is most likely due to the same issues as in <span class="citation" data-cites="leadbetter2024">Leadbetter, Caceres, and Phatak (<a href="#ref-leadbetter2024" role="doc-biblioref">2024</a>)</span>, where there is not enough information in the data to completely separate the volatility of the gamma process and the variance of the noise; see recommendations in <span class="citation" data-cites="leadbetter2024">Leadbetter, Caceres, and Phatak (<a href="#ref-leadbetter2024" role="doc-biblioref">2024</a>)</span> on how this could be removed. But as we can see in the next section, it doesn’t appear that these divergent transitions have created any multimodality in the posterior and so I do not believe they are a major issue.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href="">GP</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href="">LM</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="cell-output-display">
<div id="fig-parcoord-diag-plot-gp" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-parcoord-diag-plot-gp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-parcoord-diag-plot-gp-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-parcoord-diag-plot-gp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Prallel coordinate plot for the main parameters.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="cell-output-display">
<div id="fig-parcoord-diag-plot-lm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-parcoord-diag-plot-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-parcoord-diag-plot-lm-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-parcoord-diag-plot-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Prallel coordinate plot for the main parameters.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="posterior" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="posterior"><span class="header-section-number">6</span> Posterior</h2>
<p>The stan posterior object <code>stan_fit_full</code> contains a multidimentional posterior that holds withing it what we have learnt from the data. While it is hard to visualise the full posterior, some ways that we can visualise the posterior is by looking at the seperate marginal distribution of the parameters, the marginal distribution of intermediate(or unobservable-values), or posterior predictive distributions.</p>
<section id="marginal" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="marginal"><span class="header-section-number">6.1</span> Marginal</h3>
<p>The marginal distributions of the parameters show us directly our new belief after the prior distribution for each parameter has been updated by the data. From the marginal posteriors of the <span class="math inline">\(\mu_m\)</span> in <a href="#fig-marginal-posts-gp" class="quarto-xref">Figure&nbsp;7</a> and <a href="#fig-marginal-posts-lm" class="quarto-xref">Figure&nbsp;8</a> A, we can see that the models have identified that the “dishing out” behaviour is part of the driving underlying process. In the gamma process model (<a href="#fig-marginal-posts-gp" class="quarto-xref">Figure&nbsp;7</a>), we can also see that there is not a large variation in the <span class="math inline">\(\nu_m\)</span>; i.e.&nbsp;there is not a lot of variation in how “jumpy” the wear in different parts of the belt is-for other conveyor belts this could be very different. Lastly, the mass of <span class="math inline">\(\nu_{mean}\)</span> is reasonably far from zero, sugesting that the underlying degradation process is indeed not linear like we first suspected.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true" href="">GP</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false" href="">LM</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="cell-output-display">
<div id="fig-marginal-posts-gp" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-marginal-posts-gp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-marginal-posts-gp-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-marginal-posts-gp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: The marginal posterior distributions of the model parameters.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="cell-output-display">
<div id="fig-marginal-posts-lm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-marginal-posts-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-marginal-posts-lm-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-marginal-posts-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: The marginal posterior distributions of the model parameters.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>We can also plot the marginal posteriors and overlay the prior to see how much updating has occured. Doing so, we can also check for signs that the data have not informed the parameter or if there is conflicting information between the prior and the data. I do this in below for the gamma process model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true" href=""><span class="math inline">\(\mu\)</span></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false" href=""><span class="math inline">\(\nu\)</span> hyperparams</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false" href=""><span class="math inline">\(\sigma\)</span> and <span class="math inline">\(\phi\)</span></a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<div class="cell-output-display">
<div id="fig-post-prior-comp-mu" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-post-prior-comp-mu-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-post-prior-comp-mu-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-post-prior-comp-mu-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Comparison of the marginal prior and posterior for <span class="math inline">\(\mu\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="cell-output-display">
<div id="fig-post-prior-comp-nu" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-post-prior-comp-nu-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-post-prior-comp-nu-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-post-prior-comp-nu-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Comparison of the marginal prior and posterior for the hyper parameters of <span class="math inline">\(\nu\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="cell">
<div class="cell-output-display">
<div id="fig-post-prior-comp-var" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-post-prior-comp-var-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-post-prior-comp-var-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-post-prior-comp-var-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Comparison of the marginal prior and posterior for <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(\phi\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="intermediate-values" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="intermediate-values"><span class="header-section-number">6.2</span> Intermediate values</h3>
<p>Bayesian computation (MCMC sampling) treets missing or unobservable quantities the same as parameters. Therefore the full posterior also contains posterior samples for the unobservable <span class="math inline">\(y_{i, m}\)</span> and <span class="math inline">\(y^*_{i, m}\)</span>. The marginal posterior of the <span class="math inline">\(y^*_{i, m}\)</span>-the filtered values of the spline coeficients-give us a good insight into the variability of the underlying fitted Gamma processes which are suposedly driving the evolution of the wear profile. We can visualise this distribution in two ways; we can look at the values of the coeficients directly, or we can visualise the smooth mean wear profiles that result from the coeficient values.</p>
<section id="filtered-spline-coefs" class="level4" data-number="6.2.1">
<h4 data-number="6.2.1" class="anchored" data-anchor-id="filtered-spline-coefs"><span class="header-section-number">6.2.1</span> Filtered spline coefs</h4>
<p><a href="#fig-filtered-spline-coef-gp" class="quarto-xref">Figure&nbsp;12</a> and <a href="#fig-filtered-spline-coef-lm" class="quarto-xref">Figure&nbsp;13</a> below show a gif cycling through one hundred draws from the posterior distribution of the <span class="math inline">\(y^*_{i, m}\)</span> from each model. Essentialy it is showing us the different posible filterd coeficient pathways. The gray siloets in the background are the other 99 draws that we are cycling through.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true" href="">GP</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false" href="">LM</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div id="fig-filtered-spline-coef-gp" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-filtered-spline-coef-gp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="animation_gp.gif" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-filtered-spline-coef-gp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: An animation of 100 different samples of the filtered spline coeficient paths from the gamma process model. The colours corespond to the basis functions in <a href="#fig-B-spline-demo" class="quarto-xref">Figure&nbsp;2</a>.
</figcaption>
</figure>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div id="fig-filtered-spline-coef-lm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-filtered-spline-coef-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="animation_lm.gif" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-filtered-spline-coef-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: An animation of 100 different samples of the filtered spline coeficient paths from the general path model. The colours corespond to the basis functions in <a href="#fig-B-spline-demo" class="quarto-xref">Figure&nbsp;2</a>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p><a href="#fig-filtered-spline-coef-gp" class="quarto-xref">Figure&nbsp;12</a> does a good job at demonstrainting that while the posterior mean of each filtered path from the gamma process (like the one included in the paper) may look smooth, there are some fairly jumpy processes in the posterior. Whereas, for the linear general path model in <a href="#fig-filtered-spline-coef-lm" class="quarto-xref">Figure&nbsp;13</a>, all of the draws are perfectly strait (as one would expect).</p>
</section>
<section id="mean-wear-profiles" class="level4" data-number="6.2.2">
<h4 data-number="6.2.2" class="anchored" data-anchor-id="mean-wear-profiles"><span class="header-section-number">6.2.2</span> Mean wear profiles</h4>
<p>Alternatively, we can calculate the set of smooth spline function for each draw of the <span class="math inline">\(\{y^*_{i, m}\}^{I, M}_{i = 1, m = 1}\)</span> by applying the coeficients to the B-spline basis functions and then calculateing the value of the smooth wear profile across the width of the belt. These distributions are shown in <a href="#fig-average-wear-profile-gp" class="quarto-xref">Figure&nbsp;14</a> and <a href="#fig-average-wear-profile-lm" class="quarto-xref">Figure&nbsp;15</a> for the gamma process and general path models, respectively. What we see is a gradual monotonic growth of the profile with a reasonable amount of uncertainty around what is the average profile along the length of the belt at each observation time.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true" href="">GP</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false" href="">LM</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<div class="cell-output-display">
<div id="fig-average-wear-profile-gp" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-average-wear-profile-gp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-average-wear-profile-gp-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-average-wear-profile-gp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: The mean wear profile of the belt at each observation time from the fitted gamma process model.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<div class="cell-output-display">
<div id="fig-average-wear-profile-lm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-average-wear-profile-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-average-wear-profile-lm-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-average-wear-profile-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: The mean wear profile of the belt at each observation time from the fitted general path model.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="posterior-predictive-distributions" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="posterior-predictive-distributions"><span class="header-section-number">6.3</span> Posterior predictive distributions</h3>
<p>Even though for this particular aplication we are not interested in predicting the value of new measurements at the same time or locations as the observations, posterior predictive distributions (PPD) are a means of sense checking our fitted model. In this BHM, there are two different levels that we can generate a PPD; either the distribution of new UT measurements at the same time and location along the length of the belt; or new functional observations at the same times but at alternative locations along the length of the belt.</p>
<section id="ppd-of-ut-measurements" class="level4" data-number="6.3.1">
<h4 data-number="6.3.1" class="anchored" data-anchor-id="ppd-of-ut-measurements"><span class="header-section-number">6.3.1</span> PPD of UT measurements</h4>
<p>From the lowest level of the heirarchical posterior we can generate the predictive distribution for new UT measurements across the width of the belt at the same time and location along its length as the observed data. This essentialy shows us the fitted wear profile for each of the functional observations and the measurement uncertainty around the UT measurements that make up those profiles. The PPD of new UT measurements is generated by first extracting the noisy spline coeficient draws, the <span class="math inline">\(y_{i, m}\)</span>, and the draws of <span class="math inline">\(\sigma\)</span> from the posterior and then pushing the values back through the data model. That is, calculating the values of the B-spline at the measurement locations and then adding measurement noise by simulating from <span class="math inline">\(z_{i, n} \sim N(f_i(n), \sigma)\)</span> for every set of posterior draws.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true" href="">GP</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false" href="">LM</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sup-material-ch6_files/figure-html/ppd-ut-gp-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>The posterior predictive distribution of new UT measurements taken at the same time and location along the length fo the belt.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sup-material-ch6_files/figure-html/ppd-ut-lm-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>The posterior predictive distribution of new UT measurements taken at the same time and location along the length fo the belt.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>The PPD shows that the model is reasonably flexible, enough to fit the observed profiles and the <span class="math inline">\(98\%\)</span> uncertainty bands appear well calebrated; sinse most of observed UT data sits withing the bands.</p>
</section>
<section id="ppd-wear-profiles" class="level4" data-number="6.3.2">
<h4 data-number="6.3.2" class="anchored" data-anchor-id="ppd-wear-profiles"><span class="header-section-number">6.3.2</span> PPD wear profiles</h4>
<p>Alternatively we can generate the posterior predictive distribution of new functional observations at different locations along the length of the belt but at the same times as the observed data. To generate this second type of PPD we extract the posterior draws of the filtered spline coefficients, <span class="math inline">\(y^*_{i, m}\)</span>, and of <span class="math inline">\(\phi\)</span>. We then simulate new noisy spline coeficients by passing the draws back through the noisy component of the noisy gamma process; <span class="math inline">\(y_{i, m} \sim t_{10}(y^*_{i, m}, \phi y^*_{i, m})\)</span>. This gives us a predictive distributions for the <span class="math inline">\(y_{i, m}\)</span> which we can then tern into a distribution of new functional observations through <span class="math inline">\(f_i(.) = \sum^M_{m = 1}y_{i, m}b_m(.)\)</span>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true" href="">GP</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false" href="">LM</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sup-material-ch6_files/figure-html/ppd-fda-gp-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>The posterior predictive distributions of new functional observations taken at the same time but at different location along the length fo the belt.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sup-material-ch6_files/figure-html/ppd-fda-lm-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>The posterior predictive distributions of new functional observations taken at the same time but at different location along the length fo the belt.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>From the PPD of the functional observations, we can see the growth in uncertainty over time. This makes sense, sinse the variability in the profiles along the length of the belt should increase with time sinse the wear of the belt at each location occures from the cyclic loading of ore onto that part of the belt and the loading is not homogenious.</p>
</section>
</section>
</section>
<section id="forecast" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="forecast"><span class="header-section-number">7</span> Forecast</h2>
<p>Using the posterior draws we can generate a forecast of the belts wear by stepping the process models forward from the most recent fitted observation. The code below produces a forecast at <span class="math inline">\(t_9\)</span> from the fitted observations up to <span class="math inline">\(t_8\)</span>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true" href="">GP</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false" href="">LM</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>p_forecast_gp <span class="ot">&lt;-</span> stan_fit_full_gp <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_rvars</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">spread_rvars</span>(y[i, m], mu[m], nu[m], phi) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(i <span class="sc">==</span> <span class="fu">max</span>(i)) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">t_step =</span> t[<span class="dv">9</span>] <span class="sc">-</span> t[<span class="dv">8</span>],</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_jump =</span> <span class="fu">rvar_rgamma</span>(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">8</span>, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> (t_step <span class="sc">/</span> nu<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate =</span> (<span class="dv">1</span> <span class="sc">/</span> nu<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_forecast_std =</span> y <span class="sc">+</span> y_jump,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_forecast =</span> y_forecast_std <span class="sc">*</span> mu ,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_forecast_noisy =</span> <span class="fu">rvar_rTruncT</span>(</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="dv">8</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">nu =</span> <span class="dv">10</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> y_forecast,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> phi <span class="sc">*</span> y_forecast,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">lb =</span> <span class="dv">0</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">z_forecast =</span> y_forecast_noisy <span class="sc">%**%</span> <span class="fu">t</span>(fine_basis_mat)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>.<span class="sc">$</span>z_forecast <span class="sc">%&gt;%</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">21</span>, <span class="at">length.out =</span> <span class="fu">nrow</span>(fine_basis_mat))</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">dist =</span> value)) <span class="sc">+</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="fu">stat_dist_lineribbon</span>() <span class="sc">+</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_fill_brewer</span>() <span class="sc">+</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_true =</span> Ut_matrix[<span class="dv">9</span>, ],</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="cn">NA</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> y_true)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">30</span>)  <span class="sc">+</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="fu">xlab</span>(<span class="st">"measurement location"</span>) <span class="sc">+</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">"wear (mm)"</span>)</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>p_forecast_gp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sup-material-ch6_files/figure-html/single-forecast-gp-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>The forecasted belt wear profile at <span class="math inline">\(t_9\)</span>.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>p_forecast_lm <span class="ot">&lt;-</span> stan_fit_full_lm <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_rvars</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">spread_rvars</span>(mu[m], phi) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">t =</span> t[<span class="dv">9</span>],</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_forecast =</span> t <span class="sc">*</span> mu,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_forecast_noisy =</span> <span class="fu">rvar_rTruncT</span>(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">8</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">nu =</span> <span class="dv">10</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> y_forecast,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> phi <span class="sc">*</span> y_forecast,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">lb =</span> <span class="dv">0</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">z_forecast =</span> y_forecast_noisy <span class="sc">%**%</span> <span class="fu">t</span>(fine_basis_mat)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>.<span class="sc">$</span>z_forecast <span class="sc">%&gt;%</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">21</span>, <span class="at">length.out =</span> <span class="fu">nrow</span>(fine_basis_mat))</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">dist =</span> value)) <span class="sc">+</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="fu">stat_dist_lineribbon</span>() <span class="sc">+</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_fill_brewer</span>() <span class="sc">+</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_true =</span> Ut_matrix[<span class="dv">9</span>, ],</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="cn">NA</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> y_true)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">30</span>)  <span class="sc">+</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="fu">xlab</span>(<span class="st">"measurement location"</span>) <span class="sc">+</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">"wear (mm)"</span>)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>p_forecast_lm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sup-material-ch6_files/figure-html/single-forecast-lm-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>The forecasted belt wear profile at <span class="math inline">\(t_9\)</span>.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="failure-time-cdf" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="failure-time-cdf"><span class="header-section-number">8</span> Failure time CDF</h2>
<p>Using the posterior we can also generate a failure time distribution for the belt conditioned on the degradation observations. Since there is no closed form in this case, we must calculate the CDF numerical which is constitutionally heavy and so we do this in another R file (<code>ft-cdf.R</code>) but visualise the distributions here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>p_ft_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ft-7-obs-gp.rds"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ft-8-obs-gp.rds"</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(ft_file) {</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    ft_dist <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(ft_file)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> ft_dist <span class="sc">%&gt;%</span> </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(.draw, ft) <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">CDF =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="fu">n</span>())</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(CDF) <span class="sc">%&gt;%</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">median_qi</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ft, <span class="at">y =</span> CDF, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_lineribbon</span>() <span class="sc">+</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_brewer</span>() <span class="sc">+</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>      <span class="co">#xlim(0, 1.4) +</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fl">1.05</span>) <span class="sc">+</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(p)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>legend <span class="ot">&lt;-</span> ggpubr<span class="sc">::</span><span class="fu">get_legend</span>(p_ft_list[[<span class="dv">1</span>]])</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>p_ft_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(p_ft_list, <span class="cf">function</span>(p) p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>))</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>p_ft <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">plotlist =</span> p_ft_list,</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"(a)"</span>, <span class="st">"(b)"</span>),</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">label_fontfamily =</span> <span class="st">"Times"</span>,</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">label_x =</span> <span class="sc">-</span><span class="fl">0.01</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>p_ft</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ft-cdfs-gp" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ft-cdfs-gp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-ft-cdfs-gp-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ft-cdfs-gp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16: The failure time CDFs for the belt when the gamma process model is fit to observations A) 1 to 8 and B) 1 to 9.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>p_ft_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ft-7-obs-lm.rds"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ft-8-obs-lm.rds"</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(ft_file) {</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    ft_dist <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(ft_file)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> ft_dist <span class="sc">%&gt;%</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(.draw, ft) <span class="sc">%&gt;%</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">CDF =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="fu">n</span>())</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(CDF) <span class="sc">%&gt;%</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">median_qi</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ft, <span class="at">y =</span> CDF, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_lineribbon</span>() <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_brewer</span>() <span class="sc">+</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>      <span class="co">#xlim(0, 1.4) +</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fl">1.05</span>) <span class="sc">+</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(p)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>legend <span class="ot">&lt;-</span> ggpubr<span class="sc">::</span><span class="fu">get_legend</span>(p_ft_list[[<span class="dv">1</span>]])</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>p_ft_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(p_ft_list, <span class="cf">function</span>(p) p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>))</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>p_ft <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">plotlist =</span> p_ft_list,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"(a)"</span>, <span class="st">"(b)"</span>),</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">label_fontfamily =</span> <span class="st">"Times"</span>,</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">label_x =</span> <span class="sc">-</span><span class="fl">0.01</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>p_ft</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ft-cdfs-lm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ft-cdfs-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sup-material-ch6_files/figure-html/fig-ft-cdfs-lm-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ft-cdfs-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: The failure time CDFs for the belt when the linear general path model is fit to observations A) 1 to 8 and B) 1 to 9.
</figcaption>
</figure>
</div>
</div>
</div>

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-gabry_vis_2019" class="csl-entry" role="listitem">
Gabry, Jonah, Daniel Simpson, Aki Vehtari, Michael Betancourt, and Andrew Gelman. 2019. <span>“<span class="nocase">Visualization in Bayesian Workflow</span>.”</span> <em>Journal of the Royal Statistical Society Series A: Statistics in Society</em> 182 (2): 389–402.
</div>
<div id="ref-BDA2020" class="csl-entry" role="listitem">
Gelman, A., J. B. Carlin, H. S. Stern, D. B. Dunson, A. Vehtari, and D. B. Rubin. 2020. <em><span>B</span>ayesian <span>D</span>ata <span>A</span>nalysis, Third Edition</em>. Boca Raton, FL: Taylor &amp; Francis.
</div>
<div id="ref-leadbetter2024" class="csl-entry" role="listitem">
Leadbetter, Ryan, Gabriel Gonzalez Caceres, and Aloke Phatak. 2024. <span>“Bayesian Hierarchical Modelling of Noisy Gamma Processes: Model Formulation, Identifiability, Model Fitting, and Extensions to Unit-to-Unit Variability.”</span> <a href="https://arxiv.org/abs/2406.11216">https://arxiv.org/abs/2406.11216</a>.
</div>
<div id="ref-Stan2022" class="csl-entry" role="listitem">
Stan Development Team. 2022. <em><span>S</span>tan <span>M</span>odeling <span>L</span>anguage <span>U</span>sers <span>G</span>uide and <span>R</span>eference <span>M</span>anual</em> (version 2.31). https://mc-stan.org.
</div>
<div id="ref-webb_2020" class="csl-entry" role="listitem">
Webb, Callum, Joanna Sikorska, Ramzan Nazim Khan, and Melinda Hodkiewicz. 2020. <span>“Developing and Evaluating Predictive Conveyor Belt Wear Models.”</span> <em>Data-Centric Engineering</em> 1: e3. <a href="https://doi.org/10.1017/dce.2020.1">https://doi.org/10.1017/dce.2020.1</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>